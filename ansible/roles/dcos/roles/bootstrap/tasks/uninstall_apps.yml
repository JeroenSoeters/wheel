- name: fetch installed apps
  uri:
    url: "http://{{ groups['dcos-mesos-master'][0] }}/service/marathon/v2/apps"
    method: GET
    HEADER_Authorization: "token={{ dcos_token }}"
    HEADER_Connection: keep-alive
    HEADER_Accept: application/json
    return_content: yes
    body: {}
    body_format: json
  register: app_list

- name: extract name of installed apps
  set_fact: app_list="{{ (app_list.content | from_json )['apps'] | map(attribute='id') | list | replace("/", "") }}"

- name: uninstall apps
  uri:
    url: "http://{{ groups['dcos-mesos-master'][0] }}/service/marathon/v2/apps/{{ item }}/tasks?wipe=true"
    method: DELETE
    HEADER_Connection: keep-alive
    HEADER_Authorization: "token={{ dcos_token }}"
    HEADER_Accept: application/json
  with_items: "{{ app_list }}"
