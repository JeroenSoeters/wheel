- name: uninstall DCOS packages
  uri:
    url: "http://{{ groups['dcos-mesos-master'][0] }}/package/uninstall"
    method: POST
    HEADER_Connection: keep-alive
    HEADER_Authorization: "token={{ dcos_token }}"
    HEADER_Accept-Encoding: gzip, deflate
    HEADER_Accept: application/vnd.dcos.package.uninstall-response+json;charset=utf-8;version=v1
    HEADER_Content-Type: application/vnd.dcos.package.uninstall-request+json;charset=utf-8;version=v1
    HEADER_User-Agent: python-requests/2.10.0
    body: "{'packageName': '{{ item }}'}"
    body_format: json
  with_items: "{{ package_list }}"

#need to use 1.9 because of a string compare bug... fail
- name: install docker-py
  shell: pip install 'docker-py==1.9.0' --force-reinstall

- name: clean up zookeeper
  docker_container:
    name: janitor
    image: mesosphere/janitor
    command: ["/janitor.py","-r","{{ item }}-role","-p","{{ item }}-principal","-z","dcos-service-{{ item }}","--master_url=http://leader.mesos:5050/master/"]
  with_items: "{{ package_list }}"
